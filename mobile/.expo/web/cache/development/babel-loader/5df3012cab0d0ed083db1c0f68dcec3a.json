{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport { CodedError, Platform } from 'expo-modules-core';\nimport FontObserver from 'fontfaceobserver';\nimport { FontDisplay } from \"./Font.types\";\n\nfunction getFontFaceStyleSheet() {\n  if (!Platform.isDOMAvailable) {\n    return null;\n  }\n\n  var styleSheet = getStyleElement();\n  return styleSheet.sheet ? styleSheet.sheet : null;\n}\n\nfunction getFontFaceRules() {\n  var sheet = getFontFaceStyleSheet();\n\n  if (sheet) {\n    var rules = _toConsumableArray(sheet.cssRules);\n\n    var items = [];\n\n    for (var i = 0; i < rules.length; i++) {\n      var rule = rules[i];\n\n      if (rule instanceof CSSFontFaceRule) {\n        items.push({\n          rule: rule,\n          index: i\n        });\n      }\n    }\n\n    return items;\n  }\n\n  return [];\n}\n\nfunction getFontFaceRulesMatchingResource(fontFamilyName, options) {\n  var rules = getFontFaceRules();\n  return rules.filter(function (_ref) {\n    var rule = _ref.rule;\n    return rule.style.fontFamily === fontFamilyName && (options && options.display ? options.display === rule.style.fontDisplay : true);\n  });\n}\n\nexport default {\n  get name() {\n    return 'ExpoFontLoader';\n  },\n\n  unloadAllAsync: function () {\n    var _unloadAllAsync = _asyncToGenerator(function* () {\n      if (!Platform.isDOMAvailable) return;\n      var element = document.getElementById(ID);\n\n      if (element && element instanceof HTMLStyleElement) {\n        document.removeChild(element);\n      }\n    });\n\n    function unloadAllAsync() {\n      return _unloadAllAsync.apply(this, arguments);\n    }\n\n    return unloadAllAsync;\n  }(),\n  unloadAsync: function () {\n    var _unloadAsync = _asyncToGenerator(function* (fontFamilyName, options) {\n      var sheet = getFontFaceStyleSheet();\n      if (!sheet) return;\n      var items = getFontFaceRulesMatchingResource(fontFamilyName, options);\n\n      for (var item of items) {\n        sheet.deleteRule(item.index);\n      }\n    });\n\n    function unloadAsync(_x, _x2) {\n      return _unloadAsync.apply(this, arguments);\n    }\n\n    return unloadAsync;\n  }(),\n  loadAsync: function () {\n    var _loadAsync = _asyncToGenerator(function* (fontFamilyName, resource) {\n      if (!Platform.isDOMAvailable) {\n        return;\n      }\n\n      var canInjectStyle = document.head && typeof document.head.appendChild === 'function';\n\n      if (!canInjectStyle) {\n        throw new CodedError('ERR_WEB_ENVIRONMENT', \"The browser's `document.head` element doesn't support injecting fonts.\");\n      }\n\n      var style = _createWebStyle(fontFamilyName, resource);\n\n      document.head.appendChild(style);\n\n      if (!isFontLoadingListenerSupported()) {\n        return;\n      }\n\n      return new FontObserver(fontFamilyName, {\n        display: resource.display\n      }).load();\n    });\n\n    function loadAsync(_x3, _x4) {\n      return _loadAsync.apply(this, arguments);\n    }\n\n    return loadAsync;\n  }()\n};\nvar ID = 'expo-generated-fonts';\n\nfunction getStyleElement() {\n  var element = document.getElementById(ID);\n\n  if (element && element instanceof HTMLStyleElement) {\n    return element;\n  }\n\n  var styleElement = document.createElement('style');\n  styleElement.id = ID;\n  styleElement.type = 'text/css';\n  return styleElement;\n}\n\nfunction _createWebStyle(fontFamily, resource) {\n  var fontStyle = \"@font-face {\\n    font-family: \" + fontFamily + \";\\n    src: url(\" + resource.uri + \");\\n    font-display: \" + (resource.display || FontDisplay.AUTO) + \";\\n  }\";\n  var styleElement = getStyleElement();\n\n  if (styleElement.styleSheet) {\n    var styleElementIE = styleElement;\n    styleElementIE.styleSheet.cssText = styleElementIE.styleSheet.cssText ? styleElementIE.styleSheet.cssText + fontStyle : fontStyle;\n  } else {\n    var textNode = document.createTextNode(fontStyle);\n    styleElement.appendChild(textNode);\n  }\n\n  return styleElement;\n}\n\nfunction isFontLoadingListenerSupported() {\n  var userAgent = window.navigator.userAgent;\n  var isIOS = !!userAgent.match(/iPad|iPhone/i);\n  var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n  var isEdge = userAgent.includes('Edge');\n  var isIE = userAgent.includes('Trident');\n  var isFirefox = userAgent.includes('Firefox');\n  return !isSafari && !isIOS && !isEdge && !isIE && !isFirefox;\n}","map":{"version":3,"mappings":"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","names":["CodedError","Platform","FontObserver","FontDisplay","getFontFaceStyleSheet","isDOMAvailable","styleSheet","getStyleElement","sheet","getFontFaceRules","rules","cssRules","items","i","length","rule","CSSFontFaceRule","push","index","getFontFaceRulesMatchingResource","fontFamilyName","options","filter","style","fontFamily","display","fontDisplay","name","unloadAllAsync","element","document","getElementById","ID","HTMLStyleElement","removeChild","unloadAsync","item","deleteRule","loadAsync","resource","canInjectStyle","head","appendChild","_createWebStyle","isFontLoadingListenerSupported","load","styleElement","createElement","id","type","fontStyle","uri","AUTO","styleElementIE","cssText","textNode","createTextNode","userAgent","window","navigator","isIOS","match","isSafari","test","isEdge","includes","isIE","isFirefox"],"sourceRoot":"","sources":["../src/ExpoFontLoader.web.ts"],"sourcesContent":["import { CodedError, Platform } from 'expo-modules-core';\nimport FontObserver from 'fontfaceobserver';\n\nimport { UnloadFontOptions } from './Font';\nimport { FontDisplay, FontResource } from './Font.types';\n\nfunction getFontFaceStyleSheet(): CSSStyleSheet | null {\n  if (!Platform.isDOMAvailable) {\n    return null;\n  }\n  const styleSheet = getStyleElement();\n  return styleSheet.sheet ? (styleSheet.sheet as CSSStyleSheet) : null;\n}\n\ntype RuleItem = { rule: CSSFontFaceRule; index: number };\n\nfunction getFontFaceRules(): RuleItem[] {\n  const sheet = getFontFaceStyleSheet();\n  if (sheet) {\n    // @ts-ignore: rule iterator\n    const rules = [...sheet.cssRules];\n\n    const items: RuleItem[] = [];\n\n    for (let i = 0; i < rules.length; i++) {\n      const rule = rules[i];\n      if (rule instanceof CSSFontFaceRule) {\n        items.push({ rule, index: i });\n      }\n    }\n    return items;\n  }\n  return [];\n}\n\nfunction getFontFaceRulesMatchingResource(\n  fontFamilyName: string,\n  options?: UnloadFontOptions\n): RuleItem[] {\n  const rules = getFontFaceRules();\n  return rules.filter(({ rule }) => {\n    return (\n      rule.style.fontFamily === fontFamilyName &&\n      (options && options.display ? options.display === (rule.style as any).fontDisplay : true)\n    );\n  });\n}\n\nexport default {\n  get name(): string {\n    return 'ExpoFontLoader';\n  },\n\n  async unloadAllAsync(): Promise<void> {\n    if (!Platform.isDOMAvailable) return;\n\n    const element = document.getElementById(ID);\n    if (element && element instanceof HTMLStyleElement) {\n      document.removeChild(element);\n    }\n  },\n\n  async unloadAsync(fontFamilyName: string, options?: UnloadFontOptions): Promise<void> {\n    const sheet = getFontFaceStyleSheet();\n    if (!sheet) return;\n    const items = getFontFaceRulesMatchingResource(fontFamilyName, options);\n    for (const item of items) {\n      sheet.deleteRule(item.index);\n    }\n  },\n\n  async loadAsync(fontFamilyName: string, resource: FontResource): Promise<void> {\n    if (!Platform.isDOMAvailable) {\n      return;\n    }\n\n    const canInjectStyle = document.head && typeof document.head.appendChild === 'function';\n    if (!canInjectStyle) {\n      throw new CodedError(\n        'ERR_WEB_ENVIRONMENT',\n        `The browser's \\`document.head\\` element doesn't support injecting fonts.`\n      );\n    }\n\n    const style = _createWebStyle(fontFamilyName, resource);\n    document.head!.appendChild(style);\n\n    if (!isFontLoadingListenerSupported()) {\n      return;\n    }\n\n    return new FontObserver(fontFamilyName, { display: resource.display }).load();\n  },\n};\n\nconst ID = 'expo-generated-fonts';\n\nfunction getStyleElement(): HTMLStyleElement {\n  const element = document.getElementById(ID);\n  if (element && element instanceof HTMLStyleElement) {\n    return element;\n  }\n  const styleElement = document.createElement('style');\n  styleElement.id = ID;\n  styleElement.type = 'text/css';\n  return styleElement;\n}\n\nfunction _createWebStyle(fontFamily: string, resource: FontResource): HTMLStyleElement {\n  const fontStyle = `@font-face {\n    font-family: ${fontFamily};\n    src: url(${resource.uri});\n    font-display: ${resource.display || FontDisplay.AUTO};\n  }`;\n\n  const styleElement = getStyleElement();\n  // @ts-ignore: TypeScript does not define HTMLStyleElement::styleSheet. This is just for IE and\n  // possibly can be removed if it's unnecessary on IE 11.\n  if (styleElement.styleSheet) {\n    const styleElementIE = styleElement as any;\n    styleElementIE.styleSheet.cssText = styleElementIE.styleSheet.cssText\n      ? styleElementIE.styleSheet.cssText + fontStyle\n      : fontStyle;\n  } else {\n    const textNode = document.createTextNode(fontStyle);\n    styleElement.appendChild(textNode);\n  }\n  return styleElement;\n}\n\nfunction isFontLoadingListenerSupported(): boolean {\n  const { userAgent } = window.navigator;\n  // WebKit is broken https://github.com/bramstein/fontfaceobserver/issues/95\n  const isIOS = !!userAgent.match(/iPad|iPhone/i);\n  const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n  // Edge is broken https://github.com/bramstein/fontfaceobserver/issues/109#issuecomment-333356795\n  const isEdge = userAgent.includes('Edge');\n  // Internet Explorer\n  const isIE = userAgent.includes('Trident');\n  // Firefox\n  const isFirefox = userAgent.includes('Firefox');\n  return !isSafari && !isIOS && !isEdge && !isIE && !isFirefox;\n}\n"]},"metadata":{},"sourceType":"module"}